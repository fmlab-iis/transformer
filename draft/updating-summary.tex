Let the CFG for the $\fun{main}$ function $\underline{G}^{\fun{main}}_k = \langle V, E, \underline{\textmd{cmd}}^{\fun{main}}, \overline{\mathtt{u}}^{\fun{main}}, \overline{\mathtt{r}}^{\fun{main}},s,e \rangle$.
Function 
UpdateSummary($P_k$, $\Pi (\underline{G}^{\fun{main}}_k, \TT)$)
extracts summaries from the inductive invariant $\Pi (\underline{G}^{\fun{main}}_k, \TT)= \{ I_\ell : \ell \in V
\}$ (Algorithm~\ref{algorithm:update-summary}). 

\begin{algorithm}
  \KwIn{$P$: a program; $\{ I_\ell : \ell \in V \}$: an inductive invariant of $\underline{G}^{\fun{main}}_k$}
  \KwOut{$S[\bullet]$: function summaries}

  \ForEach{function $\fun{f}$ in the program $P$}
  {	
  	Compute the set $L_\fun{f}=\{(s_i^\fun{f},e_i^\fun{f}):s_i^\fun{f}, e_i^\fun{f}\in E\mbox{ for some }i\}$\;
  	$S[\fun{f}]:=\TT$\;
 	\ForEach{pair of locations $(\ell,\ell')\in L_\mathtt{f}$}
   	{
   		\lIf{$I_\ell$ does not contain any return variable of $\mathtt{f}$}
       	{
         		$S[\fun{f}]:=S[\fun{f}]\wedge \forall X_\mathtt{f}. (I_\ell \implies I_{\ell'})$\;
       	}
       	\lElse{
         		$S[\fun{f}]:=S[\fun{f}]\wedge \forall X_\mathtt{f}. (\TT \implies I_{\ell'})$\;       	}
   	}
    
  }
 
  \Return $S[\bullet]$\;
  \caption{
  $\textmd{UpdateSummary}(P_k, \Pi (\underline{G}^{\fun{main}}_k, \TT))$}
  \label{algorithm:update-summary}
\end{algorithm}

For each function $\fun{f}$ in the program $P$, we first compute the set $L_\fun{f}$ of entry and exit locations of the call to the function $\mathtt{f}$  and initialize its summary $S[\fun{f}]$ to $\TT$.
The set $X_\fun{f}$ contains all variables appearing in $\underline{G}^{\fun{main}}_k$ except the set of formal parameter and return variables of $\fun{main}$.
For each pairs of locations $(\ell,\ell')$ in the set $L_\fun{f}$, if the invariant of location $l$ does not contain any return variable of $\fun{f}$, we update $S[\fun{f}]$ to the formula $S[\fun{f}]\wedge \forall X_\fun{f}. (I_\ell \implies I_{\ell'})$. Otherwise, we update it to a most restricted version $S[\fun{f}]\wedge \forall X_\fun{f}. (\TT \implies I_{\ell'})$.

\begin{figure}
  \centering
  \begin{tikzpicture}[->,>=stealth',shorten >=1pt,auto,node
      distance=2cm,thick,node/.style={circle,draw}]

      \draw [fill=gray!10] (3.5, -1) ellipse (1.8 and 1.5);
      \node (text) at (3.5, -1) {$\textsc{mark}_\fun{f}(\textsc{rename}(G_\fun{f},i))$};
      \node[node] (00) at (0, 0)  {$\ell$};
      \node[node] (01) at (0, -2) {$\ell'$};
      \node[node] (10) at (3.5, 0)  {$s_i^\fun{f}$};
      \node[node] (11) at (3.5, -2) {$e_i^\fun{f}$};

      \node (arrow_s) at (5.5, -1) {};
      \node (arrow_e) at (6.5, -1) {};
      
      \node[rectangle,text centered,draw] (text) at (9, -1)
      { add $\forall X_{\mathtt{f}}.
        (I_{s_i^\fun{f}} \implies I_{e_i^\fun{f}})$
        to $S[\fun{f}]$}; 
      
      \path
        (arrow_s) edge [dotted]
                  node {} (arrow_e)
        (00) edge 
             node {$\overline{\mathtt{u}}_i^\fun{f} := \overline{p}$} (10)

        (11) edge 
             node {$\overline{\mathtt{x}} := \mathtt{\overline{r}_i^\fun{f}}$} (01) ;
    \end{tikzpicture}

  \caption{Updating Summary}
  \label{figure:updating-summary}
\end{figure}

\begin{proposition}
  \label{propposition:strengthen_postcondition}
  Given the CFG $\underline{G}^{\fun{main}}_k = \langle V, E, \underline{\textmd{cmd}}^{\fun{main}}, \overline{\mathtt{u}}^{\fun{main}}, \overline{\mathtt{r}}^{\fun{main}},s,e \rangle$ and
  define $L_\fun{f}=\{(s_i^\fun{f},e_i^\fun{f}):
  s_i^\fun{f}, e_i^\fun{f}\in E\}$.
  If $\assert{\mathtt{true}}\ \mathtt{\overline{r}}^\fun{f} := \mathtt{f}
     (\overline{\mathtt{u}}^\fun{f})\ \assert{S[\fun{f}]}$ holds, then
  $\assert{I_\ell}\ \mathtt{\overline{r}}^\fun{f} := \mathtt{f}
   (\overline{\mathtt{u}}^\fun{f})\ \assert{
     I_{\ell'}}$ for all $(\ell,\ell')\in L_\mathtt{f}$.
\end{proposition}
The proposition holds because $S[\mathtt{f}]= \bigwedge_{(\ell,\ell')\in L'_\fun{f}}\forall V_\mathtt{f}. (I_\ell \implies I_{\ell'})$ implies $\forall V_\mathtt{f}. (I_\ell \implies I_{\ell'})$ for any pair $(\ell,\ell')\in L'_\fun{f}$, which implies $I_\ell \implies I_{\ell'}$ for the same pair of locations $(\ell,\ell')$.

\begin{proposition}
\label{propposition:invariant}
Let $Q$ be a formula over all variables in $\underline{G}^{\fun{main}}_k$ excepts $\mathtt{\overline{r}}^\fun{r}$. We
We have $\assert{Q}\
  \mathtt{\overline{r}}^\fun{f} := \mathtt{f}
  (\overline{\mathtt{u}}^\fun{f})\ \assert{Q}$.
\end{proposition}
The proposition holds because the only possible overlap with variables in $Q$ and $\mathtt{\overline{r}}^\fun{f} := \mathtt{f} (\overline{\mathtt{u}}^\fun{f})$ are the formal parameters $\overline{\mathtt{u}}^\fun{f}$. However, we assume that values of formal parameters do not change in a function (see Section~\ref{section:preliminaries}), hence the values of all variables in $Q$ will stay the same after the execution of the function call $\mathtt{\overline{r}}^\fun{f} := \mathtt{f} (\overline{\mathtt{u}}^\fun{f})$.

